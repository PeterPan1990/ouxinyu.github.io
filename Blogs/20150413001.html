<!DOCTYPE HTML>
<html>

<head>
    <title>Xin-Yu Ou（欧新宇）</title>
    <meta name="description" content="欧新宇老师个人主页，用于自我介绍和为教学、科研服务。" />
    <meta name="keywords" content="Xin-Yu Ou, xinyu ou, 欧新宇, ouxinyu, shiorioy, 个人主页, 欧老师, 宇宙骑士" />
    <meta name="author" content="Xin-Yu Ou（欧新宇）" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../style/style.css" />
    <link rel="icon" href="../favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
</head>

<body>
  <div id="main">
    <div id="header">
        <script type="text/javascript" src="../js/logo_content.js"></script>


        <script type="text/javascript" src="../js/menu_content.js"></script>
    </div>
    <div id="content_header"></div>
      <div id="site_content">
          <!-- insert the page content here -->
          <h1>SPP-net安装配置指南</h1>
          <p style="text-align:right;"><a href="../Blog.html">返回</a></p>
          <p style="color:red;font-size:14px;"><strong><i>特别说明：</i></strong></p>
          <p style="color:red;font-size:14px;"><strong><i>1. 本文所用软件来自于微软2014年发布的论文《Spatial Pyramid Pooling in Deep Convolutional Networks for Visual Recognition》，源代码发布地址：https://github.com/ShaoqingRen/SPP_net</i></strong></p>
          <p style="color:red;font-size:14px;"><strong><i>1. 本文为作者亲自实验完成，但仅限用于学术交流使用，使用本指南造成的任何不良后果由使用者自行承担，与本博主无关，谢谢！</i></strong></p>
          <p style="color:red;font-size:14px;"><strong><i>2. 本文旨在为新手提供一个参考，请高手勿要吐槽，有暴力倾向者，请绕道，谢谢！</i></strong></p>
          <p style="color:red;font-size:14px;"><strong><i>3. Matlab比较崩溃的是，出错直接崩溃，没有提示信息，所以…</i></strong></p>
          <p style="color:red;font-size:14px;"><strong><i>4. 3.	最后更新时间：2015年4月14日。</i></strong></p>
          

          <p>洋洋洒洒一大篇，就没截图了，经过几个月的使用，使用Caffe还是建议在Ubuntu系统下完成，因为不需要太多的编程，Windows版需要一定的编程基础，且因为没有官方Release版，所以更新和FixBug都麻烦一些.这里有个建议是，如果将来要做大数据集，最好事先给Linux留多点空间，比如Imagenet，估计500G都不为过。不过也可以全部使用软链接链接到Windows的NTFS磁盘，我后期实验都是使用这个方法。另外，请阅读完，至少一个部分再进行动手操作，避免多余的工作，写作能力有限，尽请见谅。</p>
          <p>这篇安装指南，适合零基础，新手操作，请高手勿要吐槽！</p>
          <p>简单介绍一下：Caffe，一种Convolutional Neural Network的工具包，和Alex的cuda-convnet功能类似，但各有特点。都是使用C++ CUDA进行底层编辑，Python进行实现，原作主要部署于Ubuntu，也有大神发布了Windows版，但其他相关资料较少，不适合新手使用，所以还是Ubuntu的比较适合新手。（相对而言）</p>
          <p>本文主要包含3个部分，包括：</p>
          <ul>
              <li><strong>第一部分 运行环境</strong></li>
              <li><strong>第二部分 安装步骤</strong></li>
              <li><strong>第三部分 运行VOC2007 Demo</strong></li>
          </ul>
          <br />
          <h1 style="color:navy;">第一部分 运行环境</h1>
          <p>硬件：Intel i7-4770k, GTX 770 4G, 16G memory</p>
          <p>软件：Windows 8.1，Matlab R2014a(64bit)，Microsoft Visual Studio 2013</p>
          <p>PS：其他配置理论也可以，只要版本不要太低就行</p>

          <h1 style="color:navy;">第二部分：安装步骤</h1>
          <p class="Bold">1. 下载SPP_net-master</p>
          <p>URL：https://github.com/ShaoqingRen/SPP_net </p>
          <p>解压到D:\SPP_net-master</p>
          <p class="Bold">2.下载caffe-master (spp_net) 版</p>
          <p>URL：https://github.com/ShaoqingRen/caffe </p>
          <p>解压到D:\SPP_net-master\external\caffe</p>
          <p class="Bold">3. 下载caffe依赖文件SPP_net_release1_data_caffe_mex_cuda5.5.zip</p>
          <p>运行SPP_net-master\external\fetch_caffe_mex_5_5.m</p>
          <p>解压到D:\SPP_net-master\external\caffe\matlab\caffe</p>
          <p class="Bold">4.下载SelectiveSearchCodeIJCV</p>
          <p>URL：http://disi.unitn.it/~uijlings/MyHomepage/index.php#page=projects1 </p>
          <p>解压到D:\SPP_net-master\selective_search</p>
          <p class="Bold">5. 下载 SPP_net_release1_VOC2007_selective_search_data.zip</p>
          <p>运行：data\fetch_ss_data_voc2007.m </p>
          <p>解压到：D:\SPP_net-master\data\selective_search</p>
          <p class="Bold">6. 下载spp_net模型文件SPP_net_release1_data.zip</p>
          <p>运行：data\fetch_model_data.m </p>
          <p>解压到：D:\SPP_net-master\data 和 D:\SPP_net-master\finetuning </p>
          <p class="Bold">7. 启动SPP_net</p>
          <p>运行matlab，并执行D:\SPP_net-master\data\startup.m </p>
          <p>PS：根据代码需要，可能每次运行都要执行，其实就是载入一些初始变量。</p>
          <p class="Bold">8. 编译基本函数</p>
          <p>执行：spp_build.m，自动生成D:\SPP_net-master\bin 下liblinear_train，nms_mex，spp_pool_caffe_mex等7个mex文件 </p>
          <br />

          <h1 style="color:navy;">第三部分 运行VOC2007 Demo</h1>
          <p class="Bold">1. 下载VOC 2007 数据集</p>
          <p>包括三个文件：VOCdevkit_08-Jun-2007.tar, VOCtrainval_06-Nov-2007.tar, VOCtest_06-Nov-2007.tar VOCdevkit_08-Jun-2007</p>
          <p>全部解压到D:\SPP_net-master\datasets\VOCdevkit2007</p>
          <p>PS：原文件名VOCdevkit需要改名为VOCdevkit2007</p>

          <p class="Bold">2. 训练模型</p>
          <p>运行训练文件：D:\SPP_net-master\experiments\Script_spp_voc.m</p>
          <p>执行过程：Extract feature – Finetune FC – Train SVM – BBox Regression</p>
          <p class="navyBold">(0) 生成反转数据和imdb数据库</p>
          <p>所有训练样本被flip，并保存到D:\SPP_net-master\datasets\VOCdevkit2007\VOC2007\JPEGImages</p>
          <p>所有train，test，val，roi被保存到D:\SPP_net-master\imdb\cache</p>
          <p class="navyBold">(1) Extract Feature</p>
          <img src="20150413001/001.png" />
          <p>PS: 这一步主要是根据论文中那个multi-scale feature extraction方案进行多尺度的提取特征，多尺度的目的自然是改进性能。但是对GPU要求比较高，主要是要求较大的显存，我的GTX 770 4G并不能满足所有样本需要。为了解决这个问题，我做了两个小的修改，损失一些性能（可以看出来CPU和GPU的性能差异蛮大的）：</p>
          <p class="navyBold">1) 修改默认的多尺度窗口，也就是改小点，这里没有什么理论依据，随便改的。</p>
          <p class="red">%opts.spm_im_size  = [480 576 688 874 1200];</p>
          <p class="red">opts.spm_im_size  = [384 480 576 688 874];</p>
          <p class="navyBold">2) 修改从GPU切换到CPU的阈值，这个主要是根据你的GPU的情况</p>
          <p>  if ~use_gpu || (numel(resized_im) > 1200*2400*1.2)</p>
          <p>3) 理论上修改第二条就可以，第一条会整体降低精度，第二条只是切换GPU和CPU影响训练时间，但是测试的时候，一时也找不到一个合适的阈值，就随便设置了一个。不过根据论文，从多尺度和但尺度采样只有1%左右的性能提升，我这里只是修改了一个尺度，性能下降应该不是很明显。设备不行，也没办法！~</p>
          <p class="navyBold">(2) Finetune FC</p>
          <p class="navyBold">(3) Train SVM</p>
          <p class="navyBold">(4) BBox Regression</p>

          <p class="Bold">3. 检测</p>
          <p>单幅图像检测 D:\SPP_net-master\spp_Demo.m</p>
          <p>使用微调后的模型：D:\SPP_net-master\cachedir\Zeiler_conv5_ft(5s_flip)_fc7\voc_2007_trainval.mat</p>

          <p style="text-align:right;"><a href="../Blog.html">返回</a></p>
      </div>
    
    <script type="text/javascript" src="../js/copyright.js"></script>

  </div>
</body>
</html>
